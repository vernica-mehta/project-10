# 4/9/2025 - Literature research for non-grey atmosphere model

9:36am

Looking for papers on 2/9, I found one that is well cited and discusses a derivation for a non-grey model for an irradiated atmosphere of an exoplanet. This session I will aim to read through as much of the paper as I can before the scheduled meeting with the group at 2pm

Paper read:

This will be added to the group Zotero so we can keep track of all the papers read

## Premise of paper (Abstract and 1)

Pseudo-grey models, like the one we have used for the initial model, are useful for approximating irradiated atmospheres of stars like brown dwarfs, but overestimate temperatures at low optical depths for exoplanets.

The paper will discuss the limiting factors of the pseudo-grey model and adjust the model for a more accurate atmospheric structure with a focus on correcting opacity in the infrared.

In the plot below, the paper compares a non-grey numerical model to pseudo grey models. The pseudo grey model for optical depths above order unity align with the non-grey model quite well, with isochrones matching the shape of the numerical model. Below the order unity the pseudo-grey models fail and models that fit well in the high optical depth deviate substantially in the low optical depth.

The paper aims to add non-grey cooling effects within the upper atmosphere to the 


## Definitions (2.1)

### Radiative transfer equation (2.1.1)

For the paper, they consider a plane-parallel atmosphere in LTE that recieves both an external thermal flux $\sigma_KT^{4}_{irr}$ at an angle of $\mu$ and an internal isotropic flux from below the atmosphere $\sigma_K T^{4}_{int}$.

The paper decribes effective temperature $T_{eff}$ as the sum of the external and internal temperature:

$$ T_{eff}^4 = T_{int}^4 + \mu T_{irr}^4$$

The radiative transfer equation for the problem:

$$-\mu\frac{dI_{\mu\nu}}{dm} = \kappa_\nu I_{\nu\mu} - \kappa_\nu B_\nu(T)$$

This has to be solved for all frequencies and angles, with $dm = \rho dz$. This equation has triple depencencies of $\mu$, $\nu$ and $T$ which is too complex. 


# 10/9/2025 - Continuation of reading

# 2 - Models for comparison to the non-grey model

### Optical Depths and Opacities (2.1.2)

They need to simplify the model, the first choice is the opacities. A simplified model would find themselves using the Rosseland mean opacity $\kappa_R$ which they define as:

$$\frac{1}{\kappa_R} = \int_0^\infty \frac{1}{\kappa_\nu} \frac{\delta B_\nu(T)}{\delta T} d\nu$$

This opacity is used when at all wavelengths the mean free path of photons is small compared to the scale height of the atmosphere. Using the mean opacity, the definition of optical depth becomes:

$$d\tau= \kappa_R dm$$

This is solved assuming hydrostatic equilibrium, so $dm = \frac{dP}{g}$

The other opacity they use is the planck mean opacity $\kappa_P$ which is defined as:

$$\kappa_P = \int_0^\infty \kappa_\nu B_\nu(T)d\nu$$

They then define $\gamma_P$ as the ratio of the two opacities which was seen in the pseudo-grey model:

$$\gamma_P = \frac{\kappa_P}{\kappa_R}$$

For a grey atmosphere, $\gamma_P = 1$, but for a non-grey atmosphere, $\gamma_P > 1$. This is due to the Rossland opacity being weighted towards low opacity regions, while the Planck mean is weighted towards high opacity regions by the $\kappa_\nu$ term in each definition.

They also define the opacity for stellar flux as $\kappa_v$ as the collimated flux from the star is absorbed at different atmospheric layers. They also link this opacity to the Rosseland mean opacity with a ratio $\gamma_v$:

$$\gamma_v = \frac{\kappa_v}{\kappa_R}$$


### Picket Fence model (2.1.3)

#### From Textbook (17.6 - Line blanketing and picket fence model)
This is discussed within the textbook at chapter 17.6 about line blanketing. The main three needed parameters for the line spctrum of a stellar atmosphere are the temperature, surface gravity and chemical composition/metalicity. Early models were innadiquate as the opacity of materials had large variation at photoionisation edges and spectral lines. Additionally, there is the inward increase in temperature that causes a steeper temperature gradient than a grey atmosphere would predict due to the backwarming effect. These effects coupled with the complexity of chemical composition of stars on spectral lines in a stars opacity is referred to as line blanketing.

An statistical approach to the line blanketing problem is the picket fence model derived by Chandrasekhar. The model assumes that the continuum is in LTE and it's opacity is constant/independent over frequency. The other assumption is that the lines do not overlap and have square profiles, and the final assumption is that the lines are uniformly distributed over frequency.

This leads to the picket fence shaped plot of opacity over frequency

#### From Paper

The paper uses the picket fence model as two different sets of opacities with different wavelength dependencies may have the same Rosseland mean opacity and Planck mean opacity. The picket fence model is to constrain the model further by defining two new opacities that thermal opacities can take $\kappa_1$ and $\kappa_2$:

$$\kappa_\nu = \kappa_1 \; for \; \nu \in [n\Delta \nu, \; n\Delta \nu + \delta \nu]$$

$$\kappa_\nu = \kappa_2 \; for \; \nu \in [n\Delta \nu + \delta\nu, (n+1)\Delta\nu]$$

$$n \in [1,N]$$


$\beta$ is defined as the bandwidth:

$$\beta = \frac{1}{\int_0^\infty B_\nu d\nu}\sum_{n=1}^N \int_{n\Delta \nu}^{n\Delta \nu + \delta \nu} B_\nu d\nu$$

In the paper they choose the planck function as constant over the distance between two lines $\Delta \nu$, so $\beta$ becomes:

$$\beta \equiv \frac{\delta \nu}{\Delta \nu}$$

The Rosseland mean opacity becomes:

$$\kappa_R = \frac{\kappa_1\kappa_2}{\beta\kappa_2 + (1-\beta)\kappa_1}$$

The Planck mean opacity becomes:
$$\kappa_P = \beta \kappa_1 + (1-\beta)\kappa_2$$

And similar to before, the paper defines more ratios of opacities:

$$\gamma_1 \equiv \frac{\kappa_1}{\kappa_R}$$

$$\gamma_2 \equiv \frac{\kappa_2}{\kappa_R}$$

$$R \equiv \frac{\kappa_1}{\kappa_2} = \frac{\gamma_1}{\gamma_2}$$

They set a limit on the optical depth following the Chandrasekhar picket fence model:

$$\tau_{lim} \equiv \frac{1}{\gamma_1\gamma_2} \sqrt{\frac{\gamma_P}{3}}$$

#### My understanding of the picket fence model

Looking at both the textbook and the paper, I think I understand the picket fence model. It is a way to simplify complex line opacities if the goal isn't to model the exact spectrum but instead simulate the effects of line blanketing on atmopheric structure as a whole such as the temperature profile.

# 11/9/2025 - Continuation of reading

## Discrete Ordinate Methods (2.2)

The paper goes on to discuss the different discrete ordinate methods to approximate the integrals for the radiative transfer equation. They use it for the different approiximaate models for atmospheric structure and why they don't work for the externally irradiated atmosphere.

### Grey Atmosphere (2.2.1)

They do a Gaussian sum over the angles $\mu$ and sum up to 4 terms. Precision can be increased by adding more terms. They set the boundary condition as simply that the specific intensity of rays leaving the atmosphere at $\tau = 0$ is zero, that is $I_{\mu<0}(\tau=0) = 0$. The 4th order solution is:

$$T(\tau)^4 = \frac{3}{4}T_{int}^4(\tau + Q + L_1e^{k_1\tau} + L_2e^{k_2\tau} + L_3e^{k_3\tau})$$

Where $[Q,k_1,k_2,k_3]$ are constants. This leads to the definition of skin temperature as the temperature at $\tau = 0$:

$$T_{skin}^4 = (\frac{\sqrt{3}}{4})T_{int}^4$$

This model only works for atmospheres with no external irradiation.

### Non-grey case (2.2.2)

Developed by Chandrasekhar (1960) that takes the grey atmosphere model and adds a perturebation to include non-grey thermal effects. The model is limited to only small deviations from the grey case and required high precision numerical methods to solve or very large deviations that can be solved analytically. The paper employs the picket fence model in conjunction with the second order approximation for the angular dependency that gives the following solution:

$$T(\tau)^4 = \frac{3}{4}T_{int}^4 \left[\frac{1}{\sqrt{3\gamma_P}} + \tau + \frac{(\sqrt{\gamma_P} - \gamma_1)(\sqrt{\gamma_P} - \gamma_2)}{\gamma_1\gamma_2\sqrt{\gamma_P}}(e^{-\tau/\tau_{lim} - 1})\right]$$

Similar to the grey case, the skin temperature is defined as:

$$T_{skin}^4 = \frac{\sqrt{3}}{4\sqrt{\gamma_P}}T_{int}^4$$

The grey case occurs when $\gamma_P = 1$ where the two skin temperatures are equal.

## Moment Equations Method (2.3)

This is the method we have used for the pseudo-grey model that Vernica and Griff are coding up while I plan for the non-grey model. I will read through this section to see if there is any major departure from what we have done. 

### 2.3.1 Equations for the momentum of radiation intensity

The paper derives the moment equations from the radiative transfer equation as was done by Eddington (1916). This gives the following:

$$\frac{dH_\nu}{d\tau_\nu} = J_\nu - B_\nu(T)$$

$$\frac{dK_\nu}{d\tau_\nu} = H_\nu $$

This is the same as what the textbook has in chapter 17.7 (see notes from 2/9/2025) but instead of writing the moment equations in terms of $z$ they use optical depth $\tau_\nu$. This just eliminates the opacities and extinction terms from the equations by grouping them into the optical depth term.

Assuming radiative equilibrium, the first DE becomes:

$$\int_0^\infty \kappa_\nu (J_\nu - B_\nu) d\nu = 0$$

For the grey model, the frequency depenency of the opacity is removed and $\kappa_\nu$ becomes $\kappa_R$ and can be taken out of the integral. This leads to the same conclusion as before that $J = B$.

For a frequency dependent opacity, the solutions for the DE's have four unknowns and not closed. A closure relation is needed to relate the moments to each other, a common one is the Eddington approximation $J_\nu = 3K_\nu$. The approximation is usable for two cases: an isotropic radiation field and in the two stream approximation.

### 2.3.2 Boundary conditions



## 3 - Analytic irradiated non-grey picket fence model

### 3.1 Equations

Using the opacities defined in chapter 2.1.2 of the paper where the thermal opacities were defined as dependent on $\kappa_\nu$, coupling with a picket fence model means that there are three opacties that the model will depend on $\kappa_1$, $\kappa_2$ and $\kappa_v$. Additionally, the difference between thermal and visible channels depends on the angular dependency, not the frequency. Integrating the moment equations gives:

$$\frac{dH_{(1,2)}}{d\tau} = \gamma_{(1,2)}J_{(1,2)} - \gamma_{(1,2)}(\beta, 1-\beta)B(T)$$

$$\frac{dK_{(1,2)}}{d\tau} = \gamma_{(1,2)}H_{(1,2)}$$


The planck function is constant over each bin, that is $B_1 = \beta B(T)$ and $B_2 = (1-\beta)B(T)$. The paper assumes the Eddington approximation is valid in the to bands, that is $J_{(1,2)}=3K_{(1,2)}$. This leads to the following second order DE's by combining the two moment equations:

$$\frac{d^2J_1}{d\tau^2} = 3\gamma_1(J_1 - \beta B) \;\;\;\;\; (1)$$
$$\frac{d^2J_2}{d\tau^2} = 3\gamma_2(J_2 - (1-\beta) B) \;\;\;\;\; (2)$$

The radiative equilibrium equation:

$$\gamma_1 J_1 + \gamma_2 J_2 + \gamma_v J_v = \gamma_P B \;\;\;\;\;\;(3)$$

The paper denotes quantities with v as the momentum of the incident stellar radiation. Assuming the radaiation is collimated and arrives at an angle $\mu_* = \cos\theta_*$, the moment equations for the visible radiation are:

$$(J_\nu, H_\nu, K_\nu) = (1, \mu_*, \mu_*^2)I_*$$

where $I_*$ is the total incident intensity:

$$I_* = \int_0^\infty I_{*\nu} d\nu$$

Absorption of stellar radiation is given by the following:

$$J_v(\tau) = -\frac{H_v(0)}{\mu_*}e^{-\gamma_v^*\tau} \; \; where \; \gamma_v^*\equiv \gamma_v/\mu_*$$

Equation 1 - 3 are coupled equations, the following two variables are defined to decouple them:

$$J_\gamma \equiv \frac{J_1}{\gamma_1} + \frac{J_2}{\gamma_2}$$

$$J_{\gamma^3} \equiv \frac{J_1}{\gamma_1^3} + \frac{J_2}{\gamma_2^3}$$

Combining this with equation (1), (2) and (3) gives the following:

$$ \frac{d^2J_\gamma}{d\tau^2} = -3\gamma_vJ_v \;\;\;\; (4)$$

$$\frac{d^2J_{\gamma^3}}{d\tau^2} = 3(J_\gamma - B) \;\;\;\; (5)$$

Equation (3) becomes a linear equation:

$$ B = \frac{\gamma_1^2 + \gamma_2^2}{\gamma_P}J_\gamma - \frac{(\gamma_1\gamma_2)^2}{\gamma_P}J_{\gamma^3} + \frac{\gamma_v}{\gamma_P}J_v \;\;\;\; (6)$$

(4), (5) and (6) are now two decoupled equations and a linear equation. Defining boundary conditions allows for the solution of the system.



# 13/9/2025 - Continuation of reading

### 3.2 Boundary conditions

To solve the system of equations, boundary conditions are needed. First the high optical depth BC, i.e. $\tau \rightarrow \infty$. When $\tau$ approaches infinity, the system should approach the diffusion approximation $J_\nu = B_\nu$.

For $\tau \rightarrow 0$, the boundary condition sets the geometry of the system by setting the mean intensity and the Eddington flux of the thermal opacities to be:

$$J_{(1,2)}(0) = 2H_{(1,2)}(0)$$

### 3.3 Solution

The solution for the system of equations in the paper and is nearly two pages of algebra which will take way too much time to type out and would be unnecessary as it would essentially be copying the paper. The final solution for the temperature profile also is quite long, but will be written below as it will be used for the programming of the model:

$$T^4(\tau) = \frac{3}{4}T^4_{int} (\tau + A + Be^{-\tau/\tau_{lim}}) + \frac{3}{4}T_{irr}^4\mu(C + De^{-\tau/\tau_{lim}} Ee^{-\gamma_v^* \tau})$$

Where A, B, C, D and E are constants defined in the paper which themselves are made up of coefficients, this will be copied from the paper as well for the programming of the model:

$$A = \frac{1}{3}(a_0 + a_1b_0)$$
$$B = -\frac{1}{3}\frac{(\gamma_1 \gamma_2)^2}{\gamma_p} b_0$$
$$C = -\frac{1}{3}[b_0b_1(1 + b_2 + b_3)a_1 + a_2 + a_3]$$
$$D = \frac{1}{3}\frac{(\gamma_1 \gamma_2)^2}{\gamma_P}b_0 b_1 (1 + b_2 + b_3)$$
$$E = \frac{[3 - (\gamma_v^*/\gamma_1)][3 - (\gamma_v^*/\gamma_2)]}{9\gamma_v^*[(\gamma_v^*\tau_{lim})^2 - 1]}$$

Where:

$$a_0 = \frac{1}{\gamma_1} + \frac{1}{\gamma_2}$$
$$a_1 = -\frac{1}{3\tau_{lim}^2} \left[\frac{\gamma_P}{1 - \gamma_P}\frac{\gamma_1 + \gamma_2 - 2}{\gamma_1 + \gamma_2} + (\gamma_1 + \gamma_2)\tau_{lim} - (A_{t,1} + A_{t,2})\tau_{lim}^2\right]$$

$$a_2 = \frac{\tau_{lim}^2}{\gamma_P \gamma_v^{*2}} \frac{(3\gamma_1^2 - \gamma_v^{*2}) (3\gamma_2^2 - \gamma_v^{*2}) (\gamma_1 + \gamma_2) - 3\gamma_v^{*2}(6\gamma_1^2\gamma_2^2 - \gamma_v^{*2}(\gamma_1^2 + \gamma_2^2))}{1 - \gamma_v^{*2}\tau_{lim}}$$

$$a_3 = - \frac{\tau_{lim}^2(3\gamma_1^2 - \gamma_v^{*2})(3\gamma_2^2 - \gamma_v^{*2})(A_{v,2} + A_{v,1}) }{\gamma_P\gamma_v^{*3}(1 - \gamma_v^{*2}\tau_{lim}^2)}$$

$$b_0 = \left(\frac{\gamma_1 \gamma_2}{\gamma_1 - \gamma_2} \frac{A_{t,1} - A_{t,2}}{3} - \frac{(\gamma_1 \gamma_2)^2}{\sqrt{3\gamma_P}} - \frac{(\gamma_1\gamma_2)^3}{(1 - \gamma_1)(1 - \gamma_2)(\gamma_1 + \gamma_2)}\right)$$

$$b_1 = \frac{\gamma_1 \gamma_2 (3\gamma_1^2 - \gamma_v^{*2})(3\gamma_2^2 - \gamma_v^{*2})\tau_{lim}^2}{\gamma_P\gamma_v^{*2} (1 - \gamma_v^{*2}\tau_{lim}^2)} \$$

$$b_2 = \frac{3(\gamma_1 + \gamma_2)\gamma_v^{*2}}{(3\gamma_1^2 - \gamma_v^{*2})(\gamma_2^2 - \gamma_v^{*2})}$$

$$b_3 = \frac{A_{v,2} - A_{v,1}}{\gamma_v^*(\gamma_1 - \gamma_2)}$$

And the final coefficients are defined as:

$$A_{t,i} = \gamma_i^2\ln\left(1 + \frac{1}{\tau_{lim}\gamma_i}\right)$$
$$A_{v,i} = \gamma_i^2 \ln \left(1 + \frac{\gamma_v^*}{\gamma_i}\right)$$

## Using the model


That's the full solution, the model can be modified/varied over two pairs of paramters, specifically $(\beta,R)$ and $(\tau_{lim}, \gamma_P)$. Noted in previous parts of the reading, $\beta$ and $R$ dictate the behaviour of the picket fence model, specifically the ratio of line width $\delta\nu$ to line spacing $\Delta\nu$ and the ratio of the opacities of the thermal lines $\kappa_1$ to the thermal continuum $\kappa_2$ respectively:

$$\beta = \frac{\delta\nu}{\Delta\nu}, \;\;\; R = \frac{\kappa_1}{\kappa_2}$$

These will dictate the thermal opacities of the model, whereas changing the optical depth limit of the picket fence model $\tau_{lim}$ and ratio of the mean opacities $\gamma_P$ will change the overall shape of the entire temperature profile. Depending on which values are manipulated, they can be used to define the other pair of variables (i.e. if $(\beta, R)$ are given, then $(\gamma_1, \tau_{lim})$ and almost all other variables can be calculated).



The final major issue is that the Roselland mean opacity itself can't be calculated from other coefficients and the visible opacities are also needed. Determination of the visible opacities and inserting them into the model will be a challenge, Vernica is currently trying to get the opac code from Mike's github to give us these opacities but there is no guarantees that this might even be compatible/work with the model and cause a large amount of problems that can't be solved before the deadline. I'll start the coding over the next few days to see if I can get a basic version of the model in python and then we can try to add the opacities later if we can get them.


# 17/9/2025 - Starting the model coding
Python was the best choice for the model, I started by initially defining all of the args for the .py file so that the constants could be changed easily from the command line. Some constants were not clear in the paper, the first was their definition of the effective temperature $T_{eff}$. The paper defines it as:

$$T_{eff}^4 = T^4_{int} + \mu T^4_{irr}$$

This is problematic for us as we had set the irradiation temperature for the semi-grey model that Vernica and Griff are coding as the effective temperature of the sun, though in the textbook, this is multiplied by a dilution factor W. Earlier in the project, we found the dilution factor is defined as:

$$W = \left( \frac{R_*}{D_*}\right)^2 \times \mu^2$$

I think this paper has already mutiplied the irradiating source temperature by the dilution factor W and just called it $T_{irr}$. This means that the effective temperature is actually:

$$T_{eff}^4 = T^4_{int} + \mu W T^4_{eff \; *}$$

Therefore, initial arguments for the model are (as of writing this) with default values using the argparse package:

```python
parser = argparse.ArgumentParser()  # Sets up argparse package to define and check for arguments

# Effective surface temperature of planet in Kelvin  
parser.add_argument("--T_eff", required=False, type=int, default=143) 

# Effective radiation of the sun in kelvin for irradiation temperature
parser.add_argument("--T_eff_sun", required=False, type=int, default=6500) 

# Cosine of angle of incident radiation, default is 1 (normal incidence)
parser.add_argument("--mu", required=False, type=float, default=1) 

# Determines which variable system is used
# If True: Changing thermal opacities, variables become R and beta.
# If False: Changing overall profile, variables become kappa_P and tau_lim
parser.add_argument("--modelParamChange", required=False, type=bool, default=True)

# Ratio of Thermal line and continuum opacities kappa_1 kappa_2                                      
parser.add_argument("--R", required=False, type=float, default=0.1) 

# Partitioning of thermal opacity between two channels 
parser.add_argument("--beta", required=False, type=float, default=0.5) 

# Optical depth limit for picket fence model
parser.add_argument("--tau_lim", required=False, type=float, default=100) 

# Ratio of Planck mean thermal opacity to Roeseland mean visible opacity kappa_P/kappa_v
parser.add_argument("--gamma_P", required=False, type=float, default=0.4) 

# Checks if set up args are present in run line, if not sets default values
args = parser.parse_args() 

```
These are the initial arguments, argparse was used so that arguments could be implimented and have default values if not included in the call in the command line. 

This may also get expanded as I continue to code for any potential additions that are needed. The command line functionality may be unnecessary at a later date or requires too much work to make it functional as I can just build edit values in the code for testing the model, but for now this is a start.

Next part is the main coefficients, specifically defining the temperatures $T_{int}$ and $T_{irr}$ and the opacity ratios. This is outlined in page 9 ofthe paper:

$$\gamma_P = \beta + R - \beta R + \frac{\beta + R - \beta R}{R} - \frac{(\beta + R - \beta R)^2}{R} $$

$$\tau_lim = \frac{\sqrt()}{} $$














